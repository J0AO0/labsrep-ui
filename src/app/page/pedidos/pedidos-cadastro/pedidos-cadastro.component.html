<main>
  <p-card styleClass="card-adjust">
    <div class="mb-3">
      <span class="title colorTitle">Cadastro de Pedido</span>
    </div>

    <div class="flex justify-content-start mb-2">
      <button
        pButton
        type="button"
        class="p-button-primary"
        icon="pi pi-arrow-left"
        pTooltip="Voltar"
        routerLink="/pedidos"
      ></button>
    </div>

    <form #formPedido="ngForm">
      <div class="grid flex flex-wrap justify-content-center">
        <div class="col-12 md:col-6 lg:col-3">
          <span>Clientes</span>
          <p-dropdown
            styleClass="dropdown"
            name="operador"
            [autoDisplayFirst]="false"
            #operador="ngModel"
            filter="true"
            [options]="getClientesDropdown()"
            [virtualScroll]="true"
            [itemSize]="30"
            optionLabel="label"
            [(ngModel)]="selectedCliente"
            placeholder="Selecione..."
            [emptyFilterMessage]="messageDrop"
            [showClear]="true"
            name="selectedCliente.nome"
            required
          ></p-dropdown>
        </div>
        <div class="col-12 md:col-6 lg:col-3">
          <span>Tipo de Pedido</span>
          <p-dropdown
            styleClass="dropdown"
            name="operador"
            [autoDisplayFirst]="false"
            #operador="ngModel"
            filter="true"
            [options]="getTipoPedidoDropdown()"
            [virtualScroll]="true"
            [itemSize]="30"
            optionLabel="label"
            [(ngModel)]="selectedTipoPedido"
            placeholder="Selecione..."
            [emptyFilterMessage]="messageDrop"
            [showClear]="true"
            name="selectedTipoPedido.nome"
            required
          ></p-dropdown>
        </div>
        <div class="col-12 md:col-6 lg:col-3">
          <span>Forma de Pagamento</span>
          <p-dropdown
            styleClass="dropdown"
            name="operador"
            [autoDisplayFirst]="false"
            #operador="ngModel"
            filter="true"
            [options]="getFormaPagamentoDropdown()"
            [virtualScroll]="true"
            [itemSize]="30"
            optionLabel="label"
            [(ngModel)]="selectedFormaPagamento"
            placeholder="Selecione..."
            [emptyFilterMessage]="messageDrop"
            [showClear]="true"
            name="selectedFormaPagamento.nome"
            required
          ></p-dropdown>
        </div>
        <div class="col-12 md:col-6 lg:col-3">
          <span>Condição de Pagamento</span>
          <p-dropdown
            styleClass="dropdown"
            name="operador"
            [autoDisplayFirst]="false"
            #operador="ngModel"
            filter="true"
            [options]="getCondPagamentoDropdown()"
            [virtualScroll]="true"
            [itemSize]="30"
            optionLabel="label"
            [(ngModel)]="selectedCondPagamento"
            placeholder="Selecione..."
            [emptyFilterMessage]="messageDrop"
            [showClear]="true"
            name="selectedCondPagamento.nome"
            required
          ></p-dropdown>
        </div>
      </div>
      <div class="grid flex flex-wrap justify-content-center teste">
        <div class="col-12 md:col-6 lg:col-3 p-fluid">  
          <button pButton type="button"  class="p-button-text btn-sidebar-width alias"
                    tooltipPosition="right" label="Produtos" (click)="abrirDialogoProdutos()"  ></button>
        </div>
      </div>
      <p-table [value]="products" dataKey="sku">
        <ng-template pTemplate="header">
            <tr>
                <th>SKU</th>
                <th>Nome Produto</th>
                <th>Categoria</th>
                <th>Preço</th>
                <th>Quantidade</th>
                <th>Ações</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-product let-editing="editing">
            <tr>
                <td>{{ product.sku }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.category }}</td>
                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <input type="number" pInputText [(ngModel)]="product.price" />
                        </ng-template>
                        <ng-template pTemplate="output">
                            {{ product.price | currency:'BRL':true }}
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <input type="number" pInputText [(ngModel)]="product.quantity" />
                        </ng-template>
                        <ng-template pTemplate="output">
                            {{ product.quantity }}
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                    <button pButton type="button" icon="pi pi-trash" class="p-button-danger" (click)="deleteProduct(product)"></button>
                </td>
            </tr>
        </ng-template>
    </p-table>
    

      <div class="flex justify-content-center">
        <div class="flex align-items-center justify-content-center">
          <h3>Status</h3>
        </div>
      </div>

      <div *ngIf="salvando" class="grid flex justify-content-center mt-4">
        <p-progressSpinner
          [style]="{ width: '50px', heigth: '50px' }"
          styleClass="custom-spinner"
          strokeWidth="8"
          animation=".5s"
        ></p-progressSpinner>
        <div class="grid col-12 justify-content-center">
          <h4>Salvando aguarde...</h4>
        </div>
      </div>
    </form>
  </p-card>
</main>
<p-dialog
  header="Produtos"
  styleClass="mydialog"
  [(visible)]="displayProdutos"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
>
  <!-- Dropdown para seleção de categorias -->
  <div class="p-field">
    <label for="categoriaDropdown">Categoria</label>
    <p-dropdown 
      id="categoriaDropdown" 
      [options]="categorias" 
      [(ngModel)]="categoriaSelecionada"
      placeholder="Selecione uma categoria"
      (onChange)="filtrarProdutosPorCategoria()"
    ></p-dropdown>
  </div>

  <!-- Campo de pesquisa -->
  <div class="p-field">
    <label for="produtoPesquisa">Pesquisar Produto</label>
    <input
      id="produtoPesquisa"
      type="text"
      pInputText
      placeholder="Digite o nome do produto"
      [(ngModel)]="filtroProduto"
      (input)="filtrarProdutosPorNome()"
    />
  </div>

  <!-- Tabela de produtos -->
  <p-table
    [columns]="colsProdutos"
    [value]="produtosFiltrados"
    [loading]="loading"
    responsive="true"
  >
    <!-- Cabeçalho da Tabela -->
    <ng-template pTemplate="header" let-columns>
      <tr>
        <th>Selecionar</th>
        <th *ngFor="let col of columns">
          {{ col.header }}
        </th>
      </tr>
    </ng-template>

    <!-- Corpo da Tabela -->
    <ng-template pTemplate="body" let-rowData let-columns="columns">
      <tr>
        <td>
          <p-radioButton
            name="produto"
            [value]="rowData"
            [(ngModel)]="produtoSelecionado"
          ></p-radioButton>
        </td>
        <td *ngFor="let col of columns">
          <span class="p-column-title">{{ col.header }}:</span>
          {{ rowData[col.field] }}
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Rodapé do Dialog -->
  <ng-template pTemplate="footer">
    <button pButton label="Confirmar" icon="pi pi-check" (click)="confirmarSelecao()"></button>
    <button pButton label="Cancelar" icon="pi pi-times" (click)="cancelarSelecao()"></button>
  </ng-template>
</p-dialog>